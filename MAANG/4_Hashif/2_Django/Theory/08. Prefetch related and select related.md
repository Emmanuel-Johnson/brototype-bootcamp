# prefetch_related 

## What
`prefetch_related` is a Django ORM method that **optimizes database queries** by preloading related objects for **many-to-many** and **one-to-many** relationships in a **single extra query**. It prevents the dreaded **N+1 query problem**.

## Why
Without it, when you access related objects in a loop, Django fires a new query for each one, killing performance. `prefetch_related` fetches all related objects in bulk, reducing the number of queries drastically â€” speeding up your app and saving DB load.

## How
You call it on a QuerySet, passing the related field name(s):

```python
# Without prefetch_related (bad)
products = Product.objects.all()
for product in products:
    reviews = product.reviews.all()  # This triggers a query for each product!

# With prefetch_related (good)
products = Product.objects.prefetch_related('reviews').all()
for product in products:
    reviews = product.reviews.all()  # No extra queries here!
```

## When to use
- For **many-to-many** and **reverse foreign key** relationships
- When you want to avoid running a query inside a loop accessing related objects

## How it works under the hood
Django does two queries:
1. One to get the main objects (`Product`)
2. One to get all related objects (`Review`) for those products, then matches them in Python

## Example
Say you have:

```python
class Product(models.Model):
    name = models.CharField(max_length=100)

class Review(models.Model):
    product = models.ForeignKey(Product, related_name='reviews', on_delete=models.CASCADE)
    content = models.TextField()
```

Query with `prefetch_related`:

```python
products = Product.objects.prefetch_related('reviews').all()
for p in products:
    print(p.name)
    for r in p.reviews.all():
        print(r.content)
```

Just **2 queries** total â€” instead of 1 + number_of_products queries.

## ðŸ§  Interview Explanation

In Django ORM, prefetch_related optimizes database access by running two efficient PostgreSQL queriesâ€”one to fetch the main objects (like products) and another to fetch all related objects (like reviews) using a WHERE foreign_key IN (...) clauseâ€”then it joins them in Python. This prevents the N+1 query problem where looping over items and accessing related data would otherwise trigger a separate query for each item, severely hurting performance. By preloading related data in bulk, prefetch_related drastically reduces the number of database hits, speeds up your app, and lowers PostgreSQL server load, making it essential when working with many-to-many or reverse foreign key relationships accessed repeatedly.

<br>
<br>
<br>

# select_related 

## What 
`select_related` is a **Django ORM method** that **performs an SQL JOIN** to fetch related objects in the **same database query**.

## When 
- Use it for **forward foreign key** and **one-to-one relationships**
- Basically, when you have a **single related object** connected via `ForeignKey` or `OneToOneField` and you want to avoid extra queries when accessing that related object

## Why 
Because without `select_related`, when you access related objects, Django fires an additional query per object â€” the classic **N+1 query problem**.

With `select_related`, Django pulls the related data **in one go**, saving you from hammering the database.

## How 
It does a **SQL JOIN** under the hood, fetching both the main model and related model data with one query.

## Example:

```python
class Author(models.Model):
    name = models.CharField(max_length=100)

class Book(models.Model):
    title = models.CharField(max_length=100)
    author = models.ForeignKey(Author, on_delete=models.CASCADE)

# Without select_related:
books = Book.objects.all()
for book in books:
    print(book.author.name)  # Extra query for each book to get author

# With select_related:
books = Book.objects.select_related('author').all()
for book in books:
    print(book.author.name)  # No extra queries, joined in one SQL query
```

## Key Points:
- Use `select_related` **only on foreign keys or one-to-one fields** (single-object relations)
- It **doesn't work for reverse relations or many-to-many fields** â€” that's what `prefetch_related` is for

## ðŸ§  Interview Explanation

select_related is a Django ORM method that optimizes queries by performing an SQL JOIN to fetch related objects (via ForeignKey or OneToOneField) in a single database query. Itâ€™s perfect when you have a single related object and want to avoid the N+1 query problem, where accessing related data would otherwise trigger an extra query per item. Under the hood, Django generates a SQL JOIN statement, pulling data from both tables at once, which reduces round-trips to PostgreSQL and speeds up query performance. Unlike prefetch_related, select_related only works for forward single-object relationsâ€”not for many-to-many or reverse foreign key relationsâ€”making it essential for efficiently loading related single records without multiple queries.
